---
title: "GSoC-2017_Additions"
author: "Vandit Jain"
date: "June 2017"
output:
  pdf_document: default
  html_document: default
vignette: |
  %\VignetteIndexEntry{GSoC-2017_Additions}  %\VignetteEngine{knitr::rmarkdown}   %VignetteEncoding{UTF-8}
---

# Expected Hittting Time using CTMC
The package provides `ExpectedTime` function to calculate average hitting time from one state to another. Let the final state be j, then for every state $i \in I$, where $I$ is the set of all possible states and holding time $q_{i} > 0$ for every $i \neq j$. Assuming the conditions to be true, expected hitting time is equal to minimal non-negative solution vector $p$ to the system of linear equations:
\begin{equation}
\begin{cases}
      p_{k} = 0 & k = j \\
      -\sum_{l \in I} q_{kl}p_{k} = 1 & k \neq j
\end{cases}
\label{eq:EHT}
\end{equation}


For example, consider the continuous time markovchain which is as follows:


``` {r,message = FALSE}
library(markovchain)
states <- c("a","b","c","d")
byRow <- TRUE
gen <- matrix(data = c(-1, 1/2, 1/2, 0, 1/4, -1/2, 0, 1/4, 1/6, 0, -1/3, 1/6, 0, 0, 0, 0),
nrow = 4,byrow = byRow, dimnames = list(states,states))
ctmc <- new("ctmc",states = states, byrow = byRow, generator = gen, name = "testctmc")
```


The generator matrix of the ctmc is:
$$
M = \left(\begin{matrix}
-1 & 1/2 & 1/2 & 0\\
1/4 & -1/2 & 1/4 & 1/6\\
1/6 & 0 & -1/3 & 1/6\\
0 & 0 & 0 & 0\\
\end{matrix}\right)
$$


Now if we have to calculate expected hitting time the process will take to hit state $d$ if we start from $a$, we apply the $ExpectedTime$ function. $ExpectedTime$ function takes three inputs namely a $ctmc$ class object, initial state $i$ and the final state $j$ that we have to calculate expected hitting time.


``` {r}
ExpectedTime(ctmc,1,4)
```


We find that the expected hitting time for process to be hit state $d$ is 7 units in this case.



# Calculating Probability at time T using ctmc

The package provides a function `probabilityatT` to calculate probability of every state according to given `ctmc` object. The Kolmogorov's backward equation gives us a relation between transition matrix at any time t with the geneartor matrix: 

\begin{equation}
P'(t) = QP(t)
\end{equation}

Here we use the solution of this differential equation $P(t) = P(0)e^{tQ}$ for $t \geq 0$ and $P(0) = I$. In this equation, $P(t)$ is the transition function at time t. The value $P(t)[i][j]$ at time $P(t)$ describes the conditional probability of the state at time $t$ to be eqaul to j if it was equal to i at time $t=0$.
It takes care of the case when `ctmc` object has a generator represented by columns.
If inital state is not provided, the function returns the whole transition matrix $P(t)$.
Next, We consider both examples where intial state is given and case where initial state is not given.

In the first case, the function takes two inputs, first of them is an object of the S4 class 'ctmc' and second is the final time $t$.

``` {r}
probabilityatT(ctmc,1)
```

Here we get an output in the form of a transition matrix.

If we take the second case i.e. considering some initial input:

``` {r}
probabilityatT(ctmc,1,1)
```

In this case we get the probabilities corresponding to every state. this also includes probability that the process hits the same stae $a$ after time $t=1$.



# Plotting generator matrix of continuous-time markovchains

The package provides a `plot` function for plotting a generator matrix $Q$ in the form of a directed graph where every possible state is assigned a node. Edges connecting these nodes are weighted. Weight of the edge going from a state $i$ to state $j$ is equal to the value $Q_{ij}$. This gives a picture of the generator matrix.

For example, we build a ctmc-class object to plot it.

``` {r}
energyStates <- c("sigma", "sigma_star")
byRow <- TRUE
gen <- matrix(data = c(-3, 3,
                       1, -1), nrow = 2,
              byrow = byRow, dimnames = list(energyStates, energyStates))
molecularCTMC <- new("ctmc", states = energyStates, 
                 byrow = byRow, generator = gen, 
                 name = "Molecular Transition Model")    
```

Now if we plot this function we get the following graph:
``` {r}
plot(molecularCTMC)
```

The figure shown is built using the $igraph$ package. The package also provides options of plotting graph using $diagram$ and $DiagrameR$ package. Plot using these packages can be built using these commands:

``` {r}
plot(molecularCTMC,package = "diagram")
```


Similarly, one can easily replace $diagram$ package with $DiagrammeR$ 



# Imprecise Conitnuous-Time Markovchains
Continuous-time Markov chains are mathematical models that are used to describe the state-evolution of dynamical systems under stochastic uncertainty. However, building models usign continuous time markovchains tkae in consideration a number of assumptions which may not be realistic for the domain of application; in particular; the ability to provide exact numerical parameter assessments, and the applicability of time-homogeneity and the eponymous Markov property. Hence we take ICTMC into consideration.


More technically, an ICTMC is a set of “precise” continuous-time finite-state stochastic processes, and rather than computing expected values of functions, we seek to compute lower expectations, which are tight lower bounds on the expectations that correspond to such a set of “precise” models.


## Types of ICTMCs
For any non-empty bounded set of rate matrices $L$, and any non-empty set $M$ of probability mass functions on $X$, we define the following three sets of stochastic processes that are jointly consistent with $L$ and $M$:

* $P^{W}_{L,M}$ is the consistent set of all well-behaved stochastic processes;
* $P^{WM}_{L,M}$ is the consistent set of all well-behaved Markov chains;
* $P^{WHM}_{L,M}$ is the consistent set of all well-behaved homogeneous Markov chains.

From a practical point of view, after having specified a (precise) stochastic process, one is typically interested in the expected value of some function of interest, or the probability of some event. Similarly, in this work, our main objects of consideration will be the lower probabilities that correspond to the ICTMCs. 



## Lower Transition Rate Operators for ICTMCs

A map $Q_{l}$ from $L(X)$ to $L(X)$ is called a lower transition rate operator if, for all $f,g \in L(X)$, all $\lambda \in R_{\geq 0}$, all $\mu \in L(X)$, and all $x \in X$: 

1. $[Q_{l}m](x) = 0$
2. $[Q_{l}I](x) \geq 0 \forall y \in X$ such that $x \neq y$
3. $[Q_{l}(f + g)](x)\geq [Q_{l}f](x) + [Q_{l}g](x)$
4. $[Q_{l}(l f)](x) = \lambda Q_{l}f[(x)]$


## Lower Transition Operators
A map $T_{l}$ from $L (X )$ to $L (X )$ is called a lower transition operator if, for all $f,g \in L(X)$, all $\lambda \in R_{\geq 0}$, all $\mu \in L(X)$, and all $x \in X$: 

1. $[T_{l} f](x) \geq min(f(y) : y \in L)$
2. $[T_{l}(f +g)](x) \geq [T_{l} f](x)+[T_{l}g](x)$
3. $[T_{l}(\lambda f)](x) = l [T_{l} f](x)$






